function M = getM(n_seg, n_order, ts)
    M = [];
    for k = 1:n_seg
        M_k = [];
        %#####################################################
        % STEP 1.1: calculate M_k of the k-th segment 
        %
        %
        %
        % M_k [4*2, 8] *2: start and end
        M_k(1,:) = [1,0,0,0,0,0,0,0]; 
        M_k(2,:) = [0,1,0,0,0,0,0,0];
        M_k(3,:) = [0,0,2,0,0,0,0,0];
        M_k(4,:) = [0,0,0,6,0,0,0,0];
        
        T = ts(k);
        M_k(5,:) = [1, T, T^2, T^3, T^4, T^5, T^6, T^7]; %p
        M_k(6,:) = [0, 1, 2*T, 3*T^2, 4*T^3, 5*T^4, 6*T^5, 7*T^6]; %v
        M_k(7,:) = [0, 0, 2, 6*T, 12*T^2, 20*T^3, 30*T^4, 42*T^5]; %a
        M_k(8,:) = [0, 0, 0, 6, 24*T, 60*T^2, 120*T^3, 210*T^4]; %j
        
        M = blkdiag(M, M_k);
    end
end